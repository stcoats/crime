<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>YCSEP Dataset Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { cursor: pointer; background-color: #f2f2f2; }
    .pagination { margin-top: 15px; }
    .pagination button {
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>YCSEP Dataset Viewer</h1>

  <label>Search text: <input type="text" id="searchBox" /></label>
  <button onclick="loadPage(1)">Search</button>

  <table id="dataTable">
    <thead>
      <tr>
        <th onclick="sortBy('id')">ID</th>
        <th onclick="sortBy('channel')">Channel</th>
        <th onclick="sortBy('video_id')">Video ID</th>
        <th onclick="sortBy('speaker')">Speaker</th>
        <th onclick="sortBy('start_time')">Start</th>
        <th onclick="sortBy('end_time')">End</th>
        <th onclick="sortBy('text')">Text</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination" id="paginationControls"></div>

  <script>
    let currentPage = 1;
    let sortColumn = '';
    let sortDir = 'asc';
    const pageSize = 100;

    function loadPage(page) {
      const searchText = document.getElementById('searchBox').value;
      fetch(`/data?page=${page}&size=${pageSize}&sort=${sortColumn}&dir=${sortDir}&text=${encodeURIComponent(searchText)}`)
        .then(res => res.json())
        .then(result => {
          const data = result.data;
          const totalPages = Math.ceil(result.total / pageSize);
          const tbody = document.querySelector("#dataTable tbody");
          tbody.innerHTML = "";
          data.forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${row.id}</td>
              <td>${row.channel}</td>
              <td>${row.video_id}</td>
              <td>${row.speaker}</td>
              <td>${row.start_time}</td>
              <td>${row.end_time}</td>
              <td>${row.text}</td>
            `;
            tbody.appendChild(tr);
          });
          currentPage = page;
          renderPaginationControls(totalPages);
        });
    }

    function renderPaginationControls(totalPages) {
      const controls = document.getElementById("paginationControls");
      controls.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.style.fontWeight = 'bold';
        btn.onclick = () => loadPage(i);
        controls.appendChild(btn);
      }
    }

    function sortBy(column) {
      if (sortColumn === column) {
        sortDir = sortDir === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDir = 'asc';
      }
      loadPage(1);
    }

    // Initial load
    loadPage(1);
  </script>
</body>
</html>
